<launch>
	<arg name="joy_dev" default="/dev/input/js0" />
	<arg name="mapping_file" default="xbox360_mapping.yaml" />
	<arg name="enable_logging" default="false" />
	<!-- <arg name="speed_multiplier" default="1.0" /> -->
	<!-- <arg name="turn_multiplier" default="0.5" /> -->
	<arg name="forward_pitch_threshold" default="30.0" />
	<arg name="backward_pitch_threshold" default="-30.0" />
	<arg name="left_roll_threshold" default="-30.0" />
	<arg name="right_roll_threshold" default="30.0" />
	
	<!-- joy node -->
	<node pkg="joy" type="joy_node" name="joy_node">
		<param name="dev" value="$(arg joy_dev)" />
	</node>

	<!-- xinput node -->
	<node pkg="isc_joy" type="joystick_xbox360" name="joystick_xbox360">
		<rosparam command="load" file="$(find isc_joy)/mappings/$(arg mapping_file)" />
	</node>

	<!-- manual control node -->
	<!-- <param name="manual_control_speed_multiplier" value="$(arg speed_multiplier)" /> -->
	<!-- <param name="manual_control_turn_multiplier" value="$(arg turn_multiplier)" /> -->
	<node pkg="fetch" type="manual_control" name="manual_control" />

	<node pkg="fetch" type="gait_control" name="gait_control" output="screen"/>
	<node pkg="fetch" type="leg_mapping" name="leg_mapping" output="screen"/>

    <!-- foot_switches --> 
    <node pkg="fetch" type="foot_switches" name="foot_switches" output="screen"/>

    <!-- foot_servos -->
    <!-- turn on onboard power for testing with smaller servo -->
	<param name="foot_servos_use_onboard_power" value="false" /> 
    <!-- Use `sudo -E` to run as root, preserving environment variables. -->
    <!-- PRU memory needs to be accessed directly, so root is needed. See https://github.com/StrawsonDesign/librobotcontrol/issues/132 -->
    <!-- Environment variables must be preserved or $ROS_MASTER_URI is not set. See https://answers.ros.org/question/165246/launch-node-with-root-permissions/?answer=165386#post-id-165386 and suforeman comment-->
    <!-- Passwordless sudo must also be set up. Run `sudo visudo` and add `debian ALL=(ALL) NOPASSWD: ALL` to the end of the file. See https://serverfault.com/a/596988 -->
    <node pkg="fetch" type="foot_servos" name="foot_servos" launch-prefix="sudo -E"/>
</launch>
